System.register(["./index-legacy.3e487d44.js","./Paginator-legacy.59acba85.js"],(function(e,t){"use strict";var r,n,a,l,o,s,c,i,d,g,u,h,p,m,w,$,f,k,v,x,y,_,b,S,z,A,C,T,P,B,F,I,R,j,D,O,E,L;return{setters:[e=>{r=e.aa,n=e.a,a=e.aP,l=e.b2,o=e.e,s=e.i,c=e.a7,i=e.cb,d=e.bI,g=e.S,u=e.au,h=e.cg,p=e.ch,m=e.a_,w=e.bJ,$=e.d6,f=e.B,k=e.b3,v=e.n,x=e.t,y=e.X,_=e.c_,b=e.d8,S=e.w,z=e.d9,A=e.ce,C=e.o,T=e.h,P=e.I,B=e.v,F=e.cq,I=e.cj,R=e.aD,j=e.c3,D=e.da,O=e.c4,E=e.ab},e=>{L=e.P}],execute:function(){const t={7:"danger",2:"success",4:"neutral"},W=e=>{if(e.role<0)return null;const t=["info","neutral","accent"];return s(A,{get colorScheme(){return t[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},G=e=>{const r=n();return s(A,{get colorScheme(){var r;return null!==(r=t[e.state])&&void 0!==r?r:"info"},get children(){return r(`tasks.state.${e.state}`)}})},M=[{name:"name",textAlign:"left",w:2===r().role?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:2===r().role?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],X=e=>Math.floor(e).toString().padStart(2,"0"),q=e=>{const t=n(),A="undone"===e.done?"cancel":"delete",C="done"===e.done&&7===e.state,[T,P]=a((()=>l.post(`/task/${e.type}/${A}?tid=${e.id}`))),[B,F]=a((()=>l.post(`/task/${e.type}/retry?tid=${e.id}`))),[I,R]=o(!1),j=e.name.match(e.nameAnalyzer.regex),D=null===j?e.name:e.nameAnalyzer.title(j),O=null===e.start_time?-1:new Date(e.start_time).getTime(),E=null===e.end_time?(new Date).getTime():new Date(e.end_time).getTime();let L="-";const q=(e,t)=>{let r=t/e,n="bytes/s";return r>1024&&(r/=1024,n="KB/s"),r>1024&&(r/=1024,n="MB/s"),r>1024&&(r/=1024,n="GB/s"),`${r.toFixed(2)} ${n}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&-1!==O){const t=(E-O)/1e3,r=e.total_bytes*e.progress/100;L=q(t,r)}}else if(void 0!==e.prevProgress&&void 0!==e.prevFetchTime){const t=(e.curFetchTime-e.prevFetchTime)/1e3,r=(e.progress-e.prevProgress)*e.total_bytes/100;L=q(t,r)}return s(g,{get when(){return!I()},get children(){return[s(c,{w:"$full",p:"$2",get children(){return[s(c,{get w(){return M[0].w},spacing:"$1",get children(){return[s(i,{"on:click":e=>{e.stopPropagation()},get checked(){return e.local.selected},onChange:t=>{e.setLocal({selected:t.target.checked,expanded:e.local.expanded})}}),s(d,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:D})]}}),s(g,{get when(){return 2===r().role},get children(){return s(u,{get w(){return M[1].w},get children(){return s(W,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),s(u,{get w(){return M[2].w},get children(){return s(G,{get state(){return e.state}})}}),s(h,{get w(){return M[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return s(p,{color:"$info8",rounded:"$md"})}}),s(u,{get w(){return M[1].w},get children(){return s(m,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L})}}),s(w,{get w(){return M[5].w},gap:"$1",get children(){return[s($,{}),s(g,{get when(){return e.canRetry},get children(){return s(f,{size:"sm",disabled:!C,display:C?"block":"none",get loading(){return B()},onClick:async()=>{const e=await F();k(e,(()=>{v.info(t("tasks.retry")),R(!0)}))},get children(){return t("tasks.retry")}})}}),s(f,{size:"sm",colorScheme:"danger",get loading(){return T()},onClick:async()=>{const e=await P();k(e,(()=>{v.success(t("global.delete_success")),R(!0)}))},get children(){return t(`global.${A}`)}}),s(f,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return x((()=>!!e.local.expanded))()?t("tasks.fold"):t("tasks.expand")}})]}})]}}),s(g,{get when(){return e.local.expanded},get children(){return s(y,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[s(_,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[s(g,{when:-1!==O,get children(){return[s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.time_elapsed")}}),s(b,{color:"$neutral9",get children(){return(e=>{const t=e/1e3%60,r=e/1e3/60%60;return`${X(e/1e3/3600)}:${X(r)}:${X(t)}`})(E-O)}})]}}),s(g,{when:null!==j,get children(){return s(S,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:e=>[s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return e[0]}}),s(b,{color:"$neutral9",get children(){return e[1](j)}})]})}}),s(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.status")}}),s(b,{color:"$neutral9",get children(){return e.status}}),s(g,{get when(){return e.error},get children(){return[s(b,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.err")}}),s(b,{color:"$danger9",get children(){return e.error}})]}})]}}),s(z,{})]}})}})]}})},J=e=>{const t=n(),[u,h]=a((()=>l.get(`/task/${e.type}/${e.done}`))),[p,_]=o([]),[b,S]=o("name"),[z,A]=o(!1),I={name:(e,t)=>e.name>t.name?1:-1,creator:(e,t)=>e.creator===t.creator?e.id>t.id?1:-1:e.creator>t.creator?1:-1,state:(e,t)=>e.state===t.state?e.id>t.id?1:-1:e.state>t.state?1:-1,progress:(e,t)=>e.progress===t.progress?e.id>t.id?1:-1:e.progress<t.progress?1:-1},R=x((()=>(e,t)=>(z()?-1:1)*I[b()](e,t))),j=async()=>{const e=await h();k(e,(e=>{var t;const r=(new Date).getTime(),n={},a={},l={},o={},s={};for(const c of p())n[c.id]=c.curFetchTime,a[c.id]=c.prevFetchTime,l[c.id]=c.progress,o[c.id]=c.prevProgress,s[c.id]=c.local;_(null!==(t=null==e?void 0:e.map((e=>{var t;let c,i;e.progress===l[e.id]?(c=a[e.id],i=o[e.id]):(c=n[e.id],i=l[e.id]);const d=null!==(t=s[e.id])&&void 0!==t?t:{selected:!1,expanded:!1};return{...e,curFetchTime:r,prevFetchTime:c,prevProgress:i,local:d}})).sort(R()))&&void 0!==t?t:[])}))};if(j(),"undone"===e.done){const e=setInterval(j,2e3);C((()=>clearInterval(e)))}const[D,O]=a((()=>l.post(`/task/${e.type}/clear_done`))),[E,W]=a((()=>l.post(`/task/${e.type}/clear_succeeded`))),[G,X]=a((()=>l.post(`/task/${e.type}/retry_failed`))),[J,K]=o(""),[H,N]=o(new RegExp("")),[Q,U]=o(!1);T((()=>{try{N(new RegExp(J())),U(!1)}catch(e){U(!0)}}));const[V,Y]=o(2!==r().role),Z=x((()=>{const e=H(),t=V();return n=>e.test(n.name)&&(!t||n.creator===r().username)})),ee=x((()=>p().filter(Z()))),te=x((()=>ee().map((e=>e.local.selected)).every(Boolean))),re=x((()=>ee().map((e=>e.local.selected)).some(Boolean)&&!te())),ne=x((()=>ee().map((e=>e.local.expanded)).every(Boolean))),ae=()=>ee().filter((e=>e.local.selected)).map((e=>e.id)),[le,oe]=a((()=>l.post(`/task/${e.type}/retry_some`,ae()))),[se,ce]=a((()=>l.post(`/task/${e.type}/${ue}_some`,ae()))),ie=e=>{Object.entries(e).forEach((([e,t])=>{v.error(`${e}: ${t}`)}))},[de,ge]=o(1),ue="undone"===e.done?"cancel":"delete",he=x((()=>{const e=20*(de()-1),t=e+20;return ee().slice(e,t)})),pe=e=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:e.textAlign}),me=e=>({cursor:"pointer",onClick:()=>{b()===e.name?A(!z()):F((()=>{S(e.name),A(!1)})),j()}});return s(y,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[s(d,{size:"lg",get children(){return t(`tasks.${e.done}`)}}),s(c,{gap:"$2",flexWrap:"wrap",get children(){return[s(g,{get when(){return"done"===e.done},get children(){return[s(f,{colorScheme:"accent",get loading(){return u()},onClick:j,get children(){return t("global.refresh")}}),s(f,{get loading(){return G()},onClick:async()=>{const e=await X();k(e,(()=>j()))},get children(){return t("tasks.retry_failed")}}),s(f,{colorScheme:"danger",get loading(){return D()},onClick:async()=>{const e=await O();k(e,(()=>j()))},get children(){return t("global.clear")}}),s(f,{colorScheme:"success",get loading(){return E()},onClick:async()=>{const e=await W();k(e,(()=>j()))},get children(){return t("tasks.clear_succeeded")}})]}}),s(g,{get when(){return e.canRetry},get children(){return s(f,{colorScheme:"primary",get loading(){return le()},onClick:async()=>{const e=await oe();k(e,(e=>{ie(e),j()}))},get children(){return t("tasks.retry_selected")}})}}),s(f,{colorScheme:"warning",get loading(){return se()},onClick:async()=>{const e=await ce();k(e,(e=>{ie(e),j()}))},get children(){return t(`tasks.${ue}_selected`)}}),s(P,{width:"auto",get placeholder(){return t("tasks.filter")},get value(){return J()},onInput:e=>K(e.target.value),get invalid(){return Q()}}),s(g,{get when(){return 2===r().role},get children(){return s(i,{get checked(){return V()},onChange:e=>Y(e.target.checked),get children(){return t("tasks.show_only_mine")}})}})]}}),s(y,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[s(c,{class:"title",w:"$full",p:"$2",get children(){return[s(c,{get w(){return M[0].w},spacing:"$1",get children(){return[s(i,{get disabled(){return 0===ee().length},get checked(){return te()},get indeterminate(){return re()},onChange:e=>{return t=e.target.checked,_(p().map((e=>(Z()(e)&&(e.local.selected=t),e))));var t}}),s(m,B((()=>pe(M[0])),(()=>me(M[0])),{get children(){return t(`tasks.attr.${M[0].name}`)}}))]}}),s(g,{get when(){return 2===r().role},get children(){return s(m,B({get w(){return M[1].w}},(()=>pe(M[1])),(()=>me(M[1])),{get children(){return t(`tasks.attr.${M[1].name}`)}}))}}),s(m,B({get w(){return M[2].w}},(()=>pe(M[2])),(()=>me(M[2])),{get children(){return t(`tasks.attr.${M[2].name}`)}})),s(m,B({get w(){return M[3].w}},(()=>pe(M[3])),(()=>me(M[3])),{get children(){return t(`tasks.attr.${M[3].name}`)}})),s(m,B({get w(){return M[4].w}},(()=>pe(M[4])),{get children(){return t(`tasks.attr.${M[4].name}`)}})),s(w,{get w(){return M[5].w},gap:"$2",get children(){return[s($,{}),s(m,B((()=>pe(M[5])),{get children(){return t(`tasks.attr.${M[5].name}`)}})),s(f,{size:"xs",colorScheme:"neutral",onClick:()=>{return e=!ne(),_(p().map((t=>(Z()(t)&&(t.local.expanded=e),t))));var e},get disabled(){return 0===ee().length},get children(){return x((()=>!!ne()))()?t("tasks.fold_all"):t("tasks.expand_all")}})]}})]}}),x((()=>he().map((t=>s(q,B(t,e,{get setLocal(){return e=t.id,t=>_(p().map((r=>(r.id===e&&(r.local=t),r))));var e}}))))))]}}),s(L,{get total(){return ee().length},defaultPageSize:20,onChange:e=>{ge(e)}})]}})};e("T",(e=>{const t=n();return s(y,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[s(d,{size:"xl",get children(){return t(`tasks.${e.type}`)}}),s(y,{w:"$full",spacing:"$2",get children(){return s(S,{each:["undone","done"],children:t=>s(J,{get type(){return e.type},done:t,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})}));var K=E("<a>"),H=E("<p>"),N=E("<a target=_blank>");const Q=e("b",((e,t)=>{const n=("/"===e?"":e)+t,a="/"===r().base_path?"":r().base_path,l=n.startsWith(a),[s,c]=o(!1);return l?((d=K()).$$mouseout=()=>c(!1),d.$$mouseover=()=>c(!0),R(d,n),j((e=>{var t=s()?"text-decoration: underline":"",r=n.slice(a.length);return e.e=D(d,t,e.e),r!==e.t&&O(d,"href",e.t=r),e}),{e:void 0,t:void 0}),d):(i=H(),R(i,n),i);var i,d}));e("g",(()=>{const e=n(),[t,r]=o(!1);return{regex:/^download (.+) to \((.+)\)$/,title:e=>e[1],attrs:{[e("tasks.attr.offline_download.url")]:e=>{return(n=N()).$$mouseout=()=>r(!1),n.$$mouseover=()=>r(!0),R(n,(()=>e[1])),j((r=>{var a=t()?"text-decoration: underline":"",l=e[1];return r.e=D(n,a,r.e),l!==r.t&&O(n,"href",r.t=l),r}),{e:void 0,t:void 0}),n;var n},[e("tasks.attr.offline_download.path")]:e=>Q("",e[2])}}})),e("a",(()=>{const e=n();return{regex:/^transfer ((?:.*\/)?(.+)) to \[(.+)]$/,title:e=>e[2],attrs:{[e("tasks.attr.offline_download.transfer_src")]:e=>{return t=H(),R(t,(()=>e[1])),t;var t},[e("tasks.attr.offline_download.transfer_dst")]:e=>Q("",e[3])}}})),I(["mouseover","mouseout"])}}}));
