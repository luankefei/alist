System.register(["./index-legacy.3e487d44.js","./item_type-legacy.4bd28ded.js","./ResponsiveGrid-legacy.76be847e.js"],(function(e,r){"use strict";var t,n,a,d,i,u,l,o,g,c,s,v,m,h,p,y,f,b,w,$,C,_,x,S,k,O,T,I,j,N,B,F,q,R;return{setters:[e=>{t=e.a,n=e.i,a=e.bg,d=e.Q,i=e.au,u=e.R,l=e.I,o=e.bs,g=e.T,c=e.bi,s=e.dl,v=e.S,m=e.F,h=e.bt,p=e.b,y=e.aP,f=e.b2,b=e.e,w=e.cd,$=e.t,C=e.bI,_=e.X,x=e.dm,S=e.d1,k=e.d2,O=e.w,T=e.v,I=e.B,j=e.n,N=e.C,B=e.b3,F=e.a0},e=>{q=e.T},e=>{R=e.R}],execute:function(){const r=e=>{const r=t();return n(h,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[n(a,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var t;return r((null!==(t=e.full_name_path)&&void 0!==t?t:"common"===e.driver)?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),n(d,{get fallback(){return n(i,{get children(){return r("settings.unknown_type")}})},get children(){return[n(u,{get when(){return e.type===q.String},get children(){return n(l,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.String?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,r.currentTarget.value)}:void 0}})}}),n(u,{get when(){return e.type===q.Number},get children(){return n(l,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Number?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,parseInt(r.currentTarget.value))}:void 0}})}}),n(u,{get when(){return e.type===q.Float},get children(){return n(l,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Float?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,parseFloat(r.currentTarget.value))}:void 0}})}}),n(u,{get when(){return e.type===q.Bool},get children(){return n(o,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===q.Bool?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,r.currentTarget.checked)}:void 0}})}}),n(u,{get when(){return e.type===q.Text},get children(){return n(g,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.Text?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,r.currentTarget.value)}:void 0}})}}),n(u,{get when(){return e.type===q.Select},get children(){return n(c,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===q.Select?r=>{var t;return null===(t=e.onChange)||void 0===t?void 0:t.call(e,r)}:void 0},get children(){return n(s,{get readonly(){return e.readonly},get searchable(){return e.type===q.Select&&e.searchable},get options(){return e.options.split(",").map((t=>{var n;return{key:t,label:r((null!==(n=e.options_prefix)&&void 0!==n?n:"common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`)+`.${t}`)}}))}})}})}})]}}),n(v,{get when(){return e.help},get children(){return n(m,{get children(){return r("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function J(e,r){switch(e){case q.Bool:return!!r&&"true"===r;case q.Number:return r?parseInt(r):0;default:return r||""}}e("default",(()=>{const e=t(),{params:a,back:d,to:i}=p(),{id:u}=a,[l,o]=y((()=>f.get("/admin/driver/list")),!0),[g,c]=b({}),[s,m]=y((()=>f.get(`/admin/storage/get?id=${u}`)),!0),[h,D]=y((()=>f.get(`/admin/driver/info?driver=${G.driver}`)),!0);u?(async()=>{const e=await m();B(e,(async e=>{P(e),V(JSON.parse(e.addition));const r=await D();B(r,(e=>c({[G.driver]:e})))}))})():(async()=>{const e=await o();B(e,c)})();const[G,P]=w({}),[Q,V]=w({}),[X,z]=y((()=>(P("addition",JSON.stringify(Q)),f.post("/admin/storage/"+(u?"update":"create"),G)))),A=$((()=>{var e;const r=null===(e=g()[G.driver])||void 0===e?void 0:e.config.alert;if(console.log(r),r)return r.split("|")[0]}));return n(F,{get loading(){return u?s()||h():l()},get children(){return[n(C,{mb:"$2",get children(){return e("global."+(u?"edit":"add"))}}),n(_,{mb:"$2",spacing:"$2",get children(){return[n(r,{name:"driver",default:"",readonly:void 0!==u,required:!0,searchable:!0,get type(){return q.Select},get options(){return u?G.driver:Object.keys(g()).join(",")},get value(){return G.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:e=>{for(const r of g()[e].common)P(r.name,J(r.type,r.default));V(x((e=>{for(const r in e)delete e[r]})));for(const r of g()[e].additional)V(r.name,J(r.type,r.default));P("driver",e)}}),n(v,{get when(){return A()},get children(){return n(S,{get status(){return A()},w:"$full",get children(){return[n(k,{}),$((()=>e(`drivers.config.${G.driver}.alert`)))]}})}})]}}),n(R,{get children(){return n(v,{get when(){return g()[G.driver]},get children(){return[n(O,{get each(){return g()[G.driver].common},children:e=>n(r,T(e,{driver:"common",get value(){return G[e.name]},onChange:r=>{P(e.name,r)}}))}),n(O,{get each(){return g()[G.driver].additional},children:e=>n(r,T(e,{get driver(){return G.driver},get value(){return Q[e.name]},onChange:r=>{V(e.name,r)}}))})]}})}}),n(I,{mt:"$2",get loading(){return X()},onClick:async()=>{g()[G.driver].config.need_ms&&(j.info(e("manage.add_storage-tips")),window.open(N("/@manage/messenger"),"_blank"));const r=await z();B(r,(()=>{j.success(e("global.save_success")),d()}),((e,t)=>{r.data.id&&i(`/@manage/storages/edit/${r.data.id}`)}))},get children(){return e("global."+(u?"save":"add"))}})]}})}))}}}));
